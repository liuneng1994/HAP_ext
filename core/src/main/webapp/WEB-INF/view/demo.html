<#include "include/header.html">
    <body>
    <div class="panel">
        <div class="panel-body">
            <form class="form-horizontal" novalidate>
                <div class="row">
                    <div class="form-group col-sm-6">
                        <label class="col-sm-4 control-label">申请单号</label>
                        <div class="col-sm-8">
                            <input type="text" class="k-textbox" style="width:100%">
                        </div>
                    </div>
                    <div class="form-group col-sm-6">
                        <label class="col-sm-4 control-label">申请人</label>
                        <div class="col-sm-8">
                            <input type="text" class="k-textbox" style="width:100%">
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="form-group col-sm-6">
                        <label class="col-sm-4 control-label">申请部门</label>
                        <div class="col-sm-8">
                            <input type="text" class="k-textbox" style="width:100%">
                        </div>
                    </div>
                    <div class="form-group col-sm-6">
                        <label class="col-sm-4 control-label">申请原因</label>
                        <div class="col-sm-8">
                            <input type="text" class="k-textbox" style="width:100%">
                        </div>
                    </div>
                </div>
            </form>
            <script>
                var model = {
                    grid1: [{productId: "1", productName: "产品1", productSize: "large"},
                        {productId: "2", productName: "产品2", productSize: "large"},
                        {productId: "3", productName: "产品3", productSize: "large"}],
                    grid2: {
                        "1": [{partId: "1", partSize: "large"},
                            {partId: "2", partSize: "small"}]
                    }
                };
                var model = [{
                    productId: "1", productName: "产品1", productSize: "large", parts: [{partId: "1", partSize: "large"},
                        {partId: "2", partSize: "small"}]
                },
                    {
                        productId: "2",
                        productName: "产品2",
                        productSize: "large",
                        parts: []
                    },
                    {
                        productId: "3",
                        productName: "产品3",
                        productSize: "large",
                        parts: [{partId: "1", partSize: "large"},
                            {partId: "2", partSize: "small"}]
                    }];
            </script>
            <div class="panel">
                <div class="panel-body">
                    <div id="grid1"></div>
                </div>
            </div>
            <script>
                var grid1 = $("#grid1").kendoGrid({
                    dataSource: new kendo.data.DataSource({
                        transport: {
                            read: function (options) {
                                options.success(model);
                            }
                        },
                        schema: {
                            id: "productId",
                            model: {
                                fields: {
                                    productId: {type: "string"},
                                    productName: {type: "string"},
                                    productSize: {type: "string"}
                                }
                            }
                        }
                    }),
                    change: function () {
                        grid2.dataSource.sync();
                        var dataItem = grid1.dataItem(grid1.select());
                        dataItem.parts = dataItem.parts || [];
                        var datasource = new kendo.data.DataSource({
                            data: [{partId: "1", partSize: "large"},
                                {partId: "2", partSize: "small"}],
                            schema: {
                                model: {
                                    fields: {
                                        partId: {type: "string"},
                                        partSize: {type: "string"}
                                    }
                                }
                            }
                        });
                        grid2.setDataSource(datasource);
                    },
                    navigatable: true,
                    height: "300px",
                    resizable: true,
                    scrollable: true,
                    editable: true,
                    selectable: true,
                    pageable: {
                        pageSizes: [5, 10, 20, 50],
                        refresh: true,
                        buttonCount: 5
                    },
                    toolbar: [{
                        name: "create",
                        template: '<span class=" btn btn-primary k-grid-add">#=text#</span>'
                    }, {
                        name: "cancel",
                        template: '<span class="btn btn-default k-grid-cancel-changes">取消</span>'
                    }],
                    pageable: {
                        refresh: true,
                        pageSizes: true,
                        buttonCount: 5
                    },
                    columns: [{
                        field: "productId",
                        title: "产品编号"
                    }, {
                        field: "productName",
                        title: "产品名称"
                    }, {
                        field: "productSize",
                        title: "产品规格"
                    }]
                });
                grid1 = grid1.data("kendoGrid");
            </script>
            <div class="panel">
                <div class="panel-body">
                    <div id="grid2"></div>
                </div>
            </div>
            <script>
                var grid2 = $("#grid2").kendoGrid({
                    dataSource: new kendo.data.DataSource({
                        /*transport: {
                         read: function(options) {
                         var productId = grid1.dataItem(grid1.select()).productId.toString();
                         if (!model.grid2[productId]) {
                         model.grid2[productId] = []
                         }
                         options.success(model.grid2[productId]);
                         },
                         create: function(options) {
                         var productId = grid1.dataItem(grid1.select()).productId.toString();
                         model.grid2[productId].push(options.data);
                         options.success("");
                         },
                         update: function()
                         }*/
                        data: [],
                        schema: {
                            model: {
                                fields: {
                                    partId: {type: "string"},
                                    partSize: {type: "string"}
                                }
                            }
                        }
                    }),
                    autoBind: false,
                    autoSync: true,
                    height: 300,
                    sortable: true,
                    editable: true,
                    toolbar: [{
                        name: "create",
                        template: '<span class=" btn btn-primary k-grid-add">#=text#</span>'
                    }, {
                        name: "cancel",
                        template: '<span class="btn btn-default k-grid-cancel-changes">取消</span>'
                    }],
                    columns: [{
                        field: "partId",
                        title: "部件编号"
                    }, {
                        field: "partSize",
                        title: "部件规格"
                    }]
                });
                grid2 = grid2.data("kendoGrid");
            </script>
            <div class="panel">
                <div class="panel-body">
                    <div id="grid3"></div>
                </div>
            </div>
            <script>
                $("#grid3").kendoGrid({
                    dataSource: {
                        data: [{interfaceName: "111", min: 1, avgRespTime: 1, max: 1}],
                        schema: {
                            model: {
                                fields: {
                                    interfaceName: {type: "string"},
                                    min: {type: "number"},
                                    avgRespTime: {type: "number"},
                                    max: {type: "number"}
                                }
                            }
                        }
                    },
                    sortable: true,
                    columns: [
                        {
                            field: "interfaceName",
                            title: '<@spring.message "interface.line.interfacename"/>',
                            width: 200,
                            attributes: {style: "text-align:left"}
                        },
                        {
                            field: "min",
                            title: '<@spring.message "hss.rep.invoke.minresptime"/>',
                            width: 150,
                            attributes: {style: "text-align:right"}
                        },
                        {
                            field: "avgRespTime",
                            title: '<@spring.message "hss.rep.invoke.avgresptime"/>',
                            attributes: {style: "text-align:right"},
                            width: 150
                        },
                        {
                            field: "max",
                            title: '<@spring.message "hss.rep.invoke.maxresptime"/>',
                            width: 150,
                            attributes: {style: "text-align:right"}
                        }, {
                            command: ["edit"]
                        }
                    ],
                    editable: "inline"

                });
            </script>
            <div class="panel-footer text-right">
                <button id="save" class="btn btn-info">保存</button>
            </div>
            <script>
                $("#save").click(function () {
                    console.log(model);
                });
            </script>
        </div>
    </div>
    </body>
    </html>